name: Create Release on Commit

on:
  push:
    branches:
      - main # Or your default branch like 'master'

jobs:
  build_and_release:
    runs-on: ubuntu-latest
    permissions:
      contents: write # This permission is required to create and upload releases

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Get current commit SHA
        id: commit_sha
        run: echo "SHA=$(git rev-parse --short HEAD)" >> $GITHUB_OUTPUT

      - name: Get current date and time
        id: datetime
        run: echo "DATETIME=$(date +'%Y%m%d%H%M%S')" >> $GITHUB_OUTPUT

      - name: Zip repository
        run: zip -r release-${{ steps.datetime.outputs.DATETIME }}-${{ steps.commit_sha.outputs.SHA }}.zip . -x ".git/*" ".github/*" "node_modules/*" # Adjust exclusions as needed

      - name: Create Release
        id: create_release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ steps.datetime.outputs.DATETIME }}-${{ steps.commit_sha.outputs.SHA }}
          name: Release ${{ steps.datetime.outputs.DATETIME }}-${{ steps.commit_sha.outputs.SHA }}
          body: |
            Automated release from commit: ${{ github.sha }}
            This release zips the entire repository at the time of the commit.
          draft: false
          prerelease: false
          files: release-${{ steps.datetime.outputs.DATETIME }}-${{ steps.commit_sha.outputs.SHA }}.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
